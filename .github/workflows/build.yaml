name: Build

on: workflow_dispatch

jobs:
    Windows:
        runs-on: windows-latest

        steps:
            - uses: actions/checkout@v4
            - uses: krdlab/setup-haxe@master
              with:
                  haxe-version: latest
            - name: Setup Haxelib
              run: |
                  haxelib setup C:\haxelib
                  haxelib install hxpkg
              shell: cmd
            - name: Install packages
              run: |
                  haxelib run hxpkg install --force
                  cd .haxelib/hxcpp/git/tools/run
                  haxe compile.hxml
                  cd ../hxcpp
                  haxe compile.hxml
                  cd ../../../../..
              shell: cmd
            - name: Compile
              run: |
                  haxelib run lime rebuild cpp -release
                  haxelib run lime build cpp
              shell: cmd
            - name: Publish Artifact
              uses: actions/upload-artifact@v4
              with:
                  name: Windows
                  path: export/release/windows/bin
    Linux:
        runs-on: ubuntu-latest

        steps:
            - uses: actions/checkout@v4
            - uses: krdlab/setup-haxe@master
              with:
                  haxe-version: latest
            - name: Setup Haxelib
              run: |
                  sudo apt-get install libvlc-dev
                  sudo apt-get install libvlccore-dev
                  haxelib setup ~/haxelib
                  haxelib install hxpkg
              shell: bash
            - name: Install packages
              run: |
                  haxelib run hxpkg install --force
                  cd .haxelib/hxcpp/git/tools/run
                  haxe compile.hxml
                  cd ../hxcpp
                  haxe compile.hxml
                  cd ../../../../..
              shell: bash
            - name: Compile
              run: |
                  haxelib run lime rebuild cpp -release
                  haxelib run lime build cpp
              shell: bash
            - name: Publish Artifact
              uses: actions/upload-artifact@v4
              with:
                  name: Linux
                  path: export/release/linux/bin
